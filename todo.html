<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo</title>
  <style>
*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.19 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}body{background:#0f172a;color:#e2e8f0;transition:background-color .2s ease,color .2s ease}.app{display:flex;height:100vh;overflow:hidden}.sidebar{display:flex;width:14rem;flex-shrink:0;flex-direction:column;--tw-bg-opacity:1;background-color:rgb(30 41 59/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.sidebar-header{display:flex;align-items:center;justify-content:space-between;border-bottom-width:1px;border-color:hsla(0,0%,100%,.1);padding:.75rem 1rem}.sidebar-actions{display:flex;align-items:center;gap:.5rem}.sidebar-title{font-size:.75rem;line-height:1rem;font-weight:600;text-transform:uppercase;letter-spacing:.1em;opacity:.7}.add-list-btn{cursor:pointer;border-radius:.25rem;border-width:1px;border-color:hsla(0,0%,100%,.3);background-color:transparent;padding:.125rem .5rem;font-size:1.125rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(241 245 249/var(--tw-text-opacity,1))}.add-list-btn:hover{background-color:hsla(0,0%,100%,.15)}.theme-toggle{font-size:.95rem;line-height:1}#list-nav{margin:0;flex:1 1 0%;list-style-type:none;overflow-y:auto;padding:.5rem 0}.nav-item{display:flex;cursor:pointer;align-items:center;gap:.5rem;padding:.5rem 1rem}.nav-item:hover{background-color:hsla(0,0%,100%,.1)}.nav-item.active{--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity,1))}.nav-name{flex:1 1 0%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:.875rem;line-height:1.25rem}.nav-delete{cursor:pointer;border-radius:.25rem;border-width:0;background-color:transparent;padding-left:.25rem;padding-right:.25rem;font-size:1rem;line-height:1.5rem;color:hsla(0,0%,100%,.4);opacity:0}.nav-delete:hover{background-color:hsla(0,0%,100%,.15);--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.nav-item:hover .nav-delete{opacity:1}.nav-rename-input{width:100%;flex:1 1 0%;border-radius:.25rem;border-width:1px;border-color:hsla(0,0%,100%,.4);background-color:hsla(0,0%,100%,.15);padding:.125rem .375rem;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1));outline:2px solid transparent;outline-offset:2px}.main{flex:1 1 0%;overflow-y:auto;padding:2rem;background:#111827}#todo-list{margin:0;list-style-type:none;padding:0}.todo-item{display:flex;align-items:center;gap:.75rem;border-bottom-width:1px;--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity,1));padding-top:.625rem;padding-bottom:.625rem;border-color:#334155}.todo-item label{flex:1 1 0%;cursor:pointer}.todo-item.done label{text-decoration-line:line-through;opacity:.5}.todo-item .delete{cursor:pointer;border-radius:.25rem;border-width:0;background-color:transparent;padding:.125rem .5rem;font-size:.875rem;line-height:1.25rem;--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.todo-item .delete:hover{--tw-bg-opacity:1;background-color:rgb(254 242 242/var(--tw-bg-opacity,1))}.mb-4{margin-bottom:1rem}.flex{display:flex}.flex-1{flex:1 1 0%}.cursor-pointer{cursor:pointer}.gap-2{gap:.5rem}.rounded-lg{border-radius:.5rem}.border{border-width:1px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.bg-blue-500{--tw-bg-opacity:1;background-color:rgb(59 130 246/var(--tw-bg-opacity,1))}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-base{font-size:1rem;line-height:1.5rem}.font-bold{font-weight:700}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.outline-none{outline:2px solid transparent;outline-offset:2px}.blur{--tw-blur:blur(8px)}.blur,.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}[data-theme=light] body{background:#f8fafc;color:#0f172a}[data-theme=light] .main{background:#fff}[data-theme=light] .todo-item{border-color:#e5e7eb}[data-theme=dark] #todo-input{background:#0f172a;color:#e2e8f0;border-color:#334155}[data-theme=dark] #todo-form button[type=submit]{background:#0ea5e9!important}.hover\:bg-blue-600:hover{--tw-bg-opacity:1;background-color:rgb(37 99 235/var(--tw-bg-opacity,1))}.focus\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity,1))}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.focus\:ring-blue-200:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(191 219 254/var(--tw-ring-opacity,1))}
  </style>
</head>

<body>
  <div class="app">
    <nav class="sidebar">
      <div class="sidebar-header">
        <span class="sidebar-title">Lists</span>
        <div class="sidebar-actions">
          <button id="dashboard-btn" class="add-list-btn theme-toggle" aria-label="Go to dashboard" title="Go to dashboard">⌂</button>
          <button id="theme-toggle" class="add-list-btn theme-toggle" aria-label="Switch theme" title="Switch theme"></button>
          <button id="add-list-btn" class="add-list-btn" title="New list">+</button>
        </div>
      </div>
      <ul id="list-nav"></ul>
    </nav>
    <main class="main">
      <h1 id="list-title" class="text-3xl font-bold mb-4"></h1>
      <form id="todo-form" class="flex gap-2 mb-4">
        <input type="text" id="todo-input" autofocus class="flex-1 px-3 py-2 border border-gray-300 rounded-lg outline-none
                 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-base">
        <button type="submit"
          class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-base cursor-pointer">
          Add
        </button>
      </form>
      <ul id="todo-list"></ul>
    </main>
  </div>
  <script>
(function () {
  const KEY = 'spa-theme';
  const VALID = new Set(['dark', 'light']);
  let initialized = false;

  function normalize(mode) {
    return VALID.has(mode) ? mode : null;
  }

  function readStored() {
    try {
      return normalize(localStorage.getItem(KEY));
    } catch {
      return null;
    }
  }

  function apply(mode) {
    document.documentElement.dataset.theme = mode;
    document.documentElement.style.colorScheme = mode;
  }

  function emit(mode) {
    window.dispatchEvent(new CustomEvent('themechange', { detail: { mode } }));
  }

  function get() {
    return normalize(document.documentElement.dataset.theme) || 'dark';
  }

  function set(mode, persist = true) {
    const normalized = normalize(mode) || 'dark';
    apply(normalized);
    if (persist) {
      try {
        localStorage.setItem(KEY, normalized);
      } catch {
        // ignore storage failures
      }
    }
    emit(normalized);
    return normalized;
  }

  function init(options = {}) {
    const fallback = normalize(options.defaultMode) || 'dark';
    const stored = readStored();
    const mode = stored || fallback;
    apply(mode);
    if (!stored) {
      try {
        localStorage.setItem(KEY, mode);
      } catch {
        // ignore storage failures
      }
    }
    if (!initialized) {
      emit(mode);
      initialized = true;
    }
    return mode;
  }

  function toggle() {
    return set(get() === 'dark' ? 'light' : 'dark');
  }

  function mountToggle(button, options = {}) {
    if (!button) return;

    const darkIcon = options.darkIcon || '☀';
    const lightIcon = options.lightIcon || '☾';

    const sync = () => {
      const mode = get();
      const next = mode === 'dark' ? 'light' : 'dark';
      button.textContent = mode === 'dark' ? darkIcon : lightIcon;
      button.setAttribute('aria-label', `Switch to ${next} mode`);
      button.setAttribute('title', `Switch to ${next} mode`);
      button.dataset.mode = mode;
    };

    button.addEventListener('click', () => toggle());
    window.addEventListener('themechange', sync);
    sync();
  }

  window.Theme = {
    init,
    get,
    set,
    toggle,
    mountToggle,
  };

  window.AppNav = {
    goDashboard() {
      window.location.href = 'dashboard.html';
    },
  };
})();
  </script>
  <script>
// --- DB ---
function dbOpen() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open('todo-app', 2);
    req.onupgradeneeded = () => {
      if (!req.result.objectStoreNames.contains('state')) {
        req.result.createObjectStore('state');
      }
    };
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

function dbGet(db, key) {
  return new Promise((resolve, reject) => {
    const req = db.transaction('state').objectStore('state').get(key);
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

function dbPut(db, key, val) {
  return new Promise((resolve, reject) => {
    const req = db.transaction('state', 'readwrite').objectStore('state').put(val, key);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

function dbDelete(db, key) {
  return new Promise((resolve, reject) => {
    const req = db.transaction('state', 'readwrite').objectStore('state').delete(key);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

// --- State ---
let db;
let lists = [];
let activeListId = null;
let todos = [];

// --- Render ---
function renderNav() {
  const nav = document.getElementById('list-nav');
  nav.innerHTML = '';

  lists.forEach(list => {
    const li = document.createElement('li');
    li.className = 'nav-item' + (list.id === activeListId ? ' active' : '');
    li.innerHTML = `
      <span class="nav-name">${escapeHtml(list.name)}</span>
      <button class="nav-delete" title="Delete list">×</button>
    `;

    li.addEventListener('click', () => selectList(list.id));
    li.addEventListener('dblclick', () => renameList(list.id, li));
    li.querySelector('.nav-delete').addEventListener('click', e => {
      e.stopPropagation();
      deleteList(list.id);
    });

    nav.appendChild(li);
  });
}

function renderTodos() {
  const activeList = lists.find(l => l.id === activeListId);
  document.getElementById('list-title').textContent = activeList ? activeList.name : '';

  const list = document.getElementById('todo-list');
  list.innerHTML = '';

  todos.forEach((todo, i) => {
    const li = document.createElement('li');
    li.className = 'todo-item' + (todo.done ? ' done' : '');
    li.innerHTML = `
      <input type="checkbox" ${todo.done ? 'checked' : ''}>
      <label>${escapeHtml(todo.text)}</label>
      <button class="delete">delete</button>
    `;

    li.querySelector('input').addEventListener('change', () => toggle(i));
    li.querySelector('.delete').addEventListener('click', () => remove(i));
    li.querySelector('label').addEventListener('click', () => toggle(i));

    list.appendChild(li);
  });
}

function render() {
  renderNav();
  renderTodos();
}

function escapeHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

// --- Actions ---
function save() {
  dbPut(db, 'lists', lists);
  dbPut(db, 'todos_' + activeListId, todos);
  dbPut(db, 'activeListId', activeListId);
  render();
}

async function selectList(id) {
  activeListId = id;
  todos = (await dbGet(db, 'todos_' + id)) || [];
  dbPut(db, 'activeListId', id);
  render();
}

function createList(name) {
  const id = 'list_' + Date.now();
  lists.push({ id, name });
  activeListId = id;
  todos = [];
  save();
}

async function deleteList(id) {
  if (lists.length === 1) return;
  const idx = lists.findIndex(l => l.id === id);
  lists = lists.filter(l => l.id !== id);
  await dbDelete(db, 'todos_' + id);
  if (activeListId === id) {
    activeListId = lists[Math.min(idx, lists.length - 1)].id;
    todos = (await dbGet(db, 'todos_' + activeListId)) || [];
  }
  dbPut(db, 'lists', lists);
  dbPut(db, 'activeListId', activeListId);
  render();
}

function renameList(id, liEl) {
  const list = lists.find(l => l.id === id);
  const span = liEl.querySelector('.nav-name');
  const input = document.createElement('input');
  input.className = 'nav-rename-input';
  input.value = list.name;
  span.replaceWith(input);
  input.focus();
  input.select();
  const commit = () => {
    const name = input.value.trim();
    if (name) { list.name = name; dbPut(db, 'lists', lists); }
    renderNav();
    renderTodos();
  };
  input.addEventListener('blur', commit);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') input.blur();
    if (e.key === 'Escape') renderNav();
  });
}

function showNewListInput() {
  const nav = document.getElementById('list-nav');
  const li = document.createElement('li');
  li.className = 'nav-item';
  li.innerHTML = `<input class="nav-rename-input" placeholder="List name…">`;
  nav.appendChild(li);
  const input = li.querySelector('input');
  input.focus();
  const commit = () => {
    const name = input.value.trim();
    if (name) createList(name);
    else renderNav();
  };
  input.addEventListener('blur', commit);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') input.blur();
    if (e.key === 'Escape') renderNav();
  });
}

function add(text) {
  todos.push({ text, done: false });
  save();
}

function toggle(i) {
  todos[i].done = !todos[i].done;
  save();
}

function remove(i) {
  todos.splice(i, 1);
  save();
}

// --- Init ---
(async () => {
  Theme.init({ defaultMode: 'dark' });
  const dashboardBtn = document.getElementById('dashboard-btn');
  if (dashboardBtn) {
    dashboardBtn.addEventListener('click', () => AppNav.goDashboard());
  }
  Theme.mountToggle(document.getElementById('theme-toggle'));

  db = await dbOpen();
  const legacyTodos = await dbGet(db, 'todos');
  lists = (await dbGet(db, 'lists')) || [];

  if (lists.length === 0) {
    const id = 'list_' + Date.now();
    lists = [{ id, name: 'My List' }];
    todos = legacyTodos || [];
    activeListId = id;
    await dbPut(db, 'lists', lists);
    await dbPut(db, 'todos_' + id, todos);
    await dbDelete(db, 'todos');
  } else {
    activeListId = (await dbGet(db, 'activeListId')) || lists[0].id;
    todos = (await dbGet(db, 'todos_' + activeListId)) || [];
  }

  render();

  document.getElementById('todo-form').addEventListener('submit', e => {
    e.preventDefault();
    const input = document.getElementById('todo-input');
    const text = input.value.trim();
    if (text) { add(text); input.value = ''; }
  });
  document.getElementById('add-list-btn').addEventListener('click', showNewListInput);
})();
  </script>
</body>

</html>
